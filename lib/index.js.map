{"version":3,"file":"index.js","sources":["../js/animframe_polyfill.js","../js/tile.js","../js/grid.js","../js/keyboard_input_manager.js","../js/html_actuator.js","../js/local_storage_manager.js","../js/game_manager.js","../src/tool.js","../src/index.js"],"sourcesContent":["(function () {\n  var lastTime = 0;\n  var vendors = ['webkit', 'moz'];\n  for (var x = 0; x < vendors.length && !window.requestAnimationFrame; ++x) {\n    window.requestAnimationFrame = window[vendors[x] + 'RequestAnimationFrame'];\n    window.cancelAnimationFrame = window[vendors[x] + 'CancelAnimationFrame'] ||\n      window[vendors[x] + 'CancelRequestAnimationFrame'];\n  }\n\n  if (!window.requestAnimationFrame) {\n    window.requestAnimationFrame = function (callback) {\n      var currTime = new Date().getTime();\n      var timeToCall = Math.max(0, 16 - (currTime - lastTime));\n      var id = window.setTimeout(function () {\n        callback(currTime + timeToCall);\n      },\n      timeToCall);\n      lastTime = currTime + timeToCall;\n      return id;\n    };\n  }\n\n  if (!window.cancelAnimationFrame) {\n    window.cancelAnimationFrame = function (id) {\n      clearTimeout(id);\n    };\n  }\n}());\n","function Tile(position, value) {\n  this.x                = position.x;\n  this.y                = position.y;\n  this.value            = value || 2;\n\n  this.previousPosition = null;\n  this.mergedFrom       = null; // Tracks tiles that merged together\n}\n\nTile.prototype.savePosition = function () {\n  this.previousPosition = { x: this.x, y: this.y };\n};\n\nTile.prototype.updatePosition = function (position) {\n  this.x = position.x;\n  this.y = position.y;\n};\n\nTile.prototype.serialize = function () {\n  return {\n    position: {\n      x: this.x,\n      y: this.y\n    },\n    value: this.value\n  };\n};\n\nexport default Tile;\n","import Tile from './tile';\n\nfunction Grid(size, previousState) {\n  this.size = size;\n  this.cells = previousState ? this.fromState(previousState) : this.empty();\n}\n\n// Build a grid of the specified size\nGrid.prototype.empty = function () {\n  var cells = [];\n\n  for (var x = 0; x < this.size; x++) {\n    var row = cells[x] = [];\n\n    for (var y = 0; y < this.size; y++) {\n      row.push(null);\n    }\n  }\n\n  return cells;\n};\n\nGrid.prototype.fromState = function (state) {\n  var cells = [];\n\n  for (var x = 0; x < this.size; x++) {\n    var row = cells[x] = [];\n\n    for (var y = 0; y < this.size; y++) {\n      var tile = state[x][y];\n      row.push(tile ? new Tile(tile.position, tile.value) : null);\n    }\n  }\n\n  return cells;\n};\n\n// Find the first available random position\nGrid.prototype.randomAvailableCell = function () {\n  var cells = this.availableCells();\n\n  if (cells.length) {\n    return cells[Math.floor(Math.random() * cells.length)];\n  }\n};\n\nGrid.prototype.availableCells = function () {\n  var cells = [];\n\n  this.eachCell(function (x, y, tile) {\n    if (!tile) {\n      cells.push({ x: x, y: y });\n    }\n  });\n\n  return cells;\n};\n\n// Call callback for every cell\nGrid.prototype.eachCell = function (callback) {\n  for (var x = 0; x < this.size; x++) {\n    for (var y = 0; y < this.size; y++) {\n      callback(x, y, this.cells[x][y]);\n    }\n  }\n};\n\n// Check if there are any cells available\nGrid.prototype.cellsAvailable = function () {\n  return !!this.availableCells().length;\n};\n\n// Check if the specified cell is taken\nGrid.prototype.cellAvailable = function (cell) {\n  return !this.cellOccupied(cell);\n};\n\nGrid.prototype.cellOccupied = function (cell) {\n  return !!this.cellContent(cell);\n};\n\nGrid.prototype.cellContent = function (cell) {\n  if (this.withinBounds(cell)) {\n    return this.cells[cell.x][cell.y];\n  } else {\n    return null;\n  }\n};\n\n// Inserts a tile at its position\nGrid.prototype.insertTile = function (tile) {\n  this.cells[tile.x][tile.y] = tile;\n};\n\nGrid.prototype.removeTile = function (tile) {\n  this.cells[tile.x][tile.y] = null;\n};\n\nGrid.prototype.withinBounds = function (position) {\n  return position.x >= 0 && position.x < this.size &&\n         position.y >= 0 && position.y < this.size;\n};\n\nGrid.prototype.serialize = function () {\n  var cellState = [];\n\n  for (var x = 0; x < this.size; x++) {\n    var row = cellState[x] = [];\n\n    for (var y = 0; y < this.size; y++) {\n      row.push(this.cells[x][y] ? this.cells[x][y].serialize() : null);\n    }\n  }\n\n  return {\n    size: this.size,\n    cells: cellState\n  };\n};\n\nexport default Grid;\n","/**\n * @param {GameConfig} config\n * @constructor\n */\nfunction KeyboardInputManager(config) {\n  this.config = config;\n  this.events = {};\n\n  if (window.navigator.msPointerEnabled) {\n    //Internet Explorer 10 style\n    this.eventTouchstart    = \"MSPointerDown\";\n    this.eventTouchmove     = \"MSPointerMove\";\n    this.eventTouchend      = \"MSPointerUp\";\n  } else {\n    this.eventTouchstart    = \"touchstart\";\n    this.eventTouchmove     = \"touchmove\";\n    this.eventTouchend      = \"touchend\";\n  }\n\n  this.listen();\n}\n\nKeyboardInputManager.prototype.on = function (event, callback) {\n  if (!this.events[event]) {\n    this.events[event] = [];\n  }\n  this.events[event].push(callback);\n};\n\nKeyboardInputManager.prototype.emit = function (event, data) {\n  var callbacks = this.events[event];\n  if (callbacks) {\n    callbacks.forEach(function (callback) {\n      callback(data);\n    });\n  }\n};\n\nKeyboardInputManager.prototype.listen = function () {\n  var self = this;\n\n  var map = {\n    38: 0, // Up\n    39: 1, // Right\n    40: 2, // Down\n    37: 3, // Left\n    75: 0, // Vim up\n    76: 1, // Vim right\n    74: 2, // Vim down\n    72: 3, // Vim left\n    87: 0, // W\n    68: 1, // D\n    83: 2, // S\n    65: 3  // A\n  };\n\n  // Respond to direction keys\n  document.addEventListener(\"keydown\", function (event) {\n    var modifiers = event.altKey || event.ctrlKey || event.metaKey ||\n                    event.shiftKey;\n    var mapped    = map[event.which];\n\n    // Ignore the event if it's happening in a text field\n    if (self.targetIsInput(event)) return;\n\n    if (!modifiers) {\n      if (mapped !== undefined) {\n        event.preventDefault();\n        self.emit(\"move\", mapped);\n      }\n    }\n\n    // R key restarts the game\n    if (!modifiers && event.which === 82) {\n      self.restart.call(self, event);\n    }\n  });\n\n  // Respond to button presses\n  this.bindButtonPress(this.config.retryButton, this.restart);\n  this.bindButtonPress(\".restart-button\", this.restart);\n  this.bindButtonPress(this.config.keepPlayingButton, this.keepPlaying);\n\n  // Respond to swipe events\n  var touchStartClientX, touchStartClientY;\n  var gameContainer = this.config.gameContainer;\n\n  gameContainer.addEventListener(this.eventTouchstart, function (event) {\n    if ((!window.navigator.msPointerEnabled && event.touches.length > 1) ||\n        event.targetTouches.length > 1 ||\n        self.targetIsInput(event)) {\n      return; // Ignore if touching with more than 1 finger or touching input\n    }\n\n    if (window.navigator.msPointerEnabled) {\n      touchStartClientX = event.pageX;\n      touchStartClientY = event.pageY;\n    } else {\n      touchStartClientX = event.touches[0].clientX;\n      touchStartClientY = event.touches[0].clientY;\n    }\n\n    event.preventDefault();\n  });\n\n  gameContainer.addEventListener(this.eventTouchmove, function (event) {\n    event.preventDefault();\n  });\n\n  gameContainer.addEventListener(this.eventTouchend, function (event) {\n    if ((!window.navigator.msPointerEnabled && event.touches.length > 0) ||\n        event.targetTouches.length > 0 ||\n        self.targetIsInput(event)) {\n      return; // Ignore if still touching with one or more fingers or input\n    }\n\n    var touchEndClientX, touchEndClientY;\n\n    if (window.navigator.msPointerEnabled) {\n      touchEndClientX = event.pageX;\n      touchEndClientY = event.pageY;\n    } else {\n      touchEndClientX = event.changedTouches[0].clientX;\n      touchEndClientY = event.changedTouches[0].clientY;\n    }\n\n    var dx = touchEndClientX - touchStartClientX;\n    var absDx = Math.abs(dx);\n\n    var dy = touchEndClientY - touchStartClientY;\n    var absDy = Math.abs(dy);\n\n    if (Math.max(absDx, absDy) > 10) {\n      // (right : left) : (down : up)\n      self.emit(\"move\", absDx > absDy ? (dx > 0 ? 1 : 3) : (dy > 0 ? 2 : 0));\n    }\n  });\n};\n\nKeyboardInputManager.prototype.restart = function (event) {\n  event.preventDefault();\n  this.emit(\"restart\");\n};\n\nKeyboardInputManager.prototype.keepPlaying = function (event) {\n  event.preventDefault();\n  this.emit(\"keepPlaying\");\n};\n\nKeyboardInputManager.prototype.bindButtonPress = function (selector, fn) {\n  var button = selector instanceof HTMLElement ? selector : document.querySelector(selector);\n  button.addEventListener(\"click\", fn.bind(this));\n  button.addEventListener(this.eventTouchend, fn.bind(this));\n};\n\nKeyboardInputManager.prototype.targetIsInput = function (event) {\n  return event.target.tagName.toLowerCase() === \"input\";\n};\n\nexport default KeyboardInputManager;\n","const GAME_WIN_CLASSNAME = 'game-won';\nconst GAME_OVER_CLASSNAME = 'game-over';\nconst SCORE_ADD_CLASSNAME = 'score-addition';\n\n/**\n * @param {GameConfig} config\n * @constructor\n */\nfunction HTMLActuator(config) {\n  this.tileContainer    = config.tileContainer;\n  this.scoreContainer   = config.scoreContainer;\n  this.bestContainer    = config.bestContainer;\n  this.messageContainer = config.gameMessageContainer;\n\n  this.score = 0;\n  this.config = config;\n}\n\nHTMLActuator.prototype.actuate = function (grid, metadata) {\n  var self = this;\n\n  window.requestAnimationFrame(function () {\n    self.clearContainer(self.tileContainer);\n\n    grid.cells.forEach(function (column) {\n      column.forEach(function (cell) {\n        if (cell) {\n          self.addTile(cell);\n        }\n      });\n    });\n\n    self.updateScore(metadata.score);\n    self.updateBestScore(metadata.bestScore);\n\n    if (metadata.terminated) {\n      if (metadata.over) {\n        self.message(false); // You lose\n      } else if (metadata.won) {\n        self.message(true); // You win!\n      }\n    }\n\n  });\n};\n\n// Continues the game (both restart and keep playing)\nHTMLActuator.prototype.continueGame = function () {\n  this.clearMessage();\n};\n\nHTMLActuator.prototype.clearContainer = function (container) {\n  while (container.firstChild) {\n    container.removeChild(container.firstChild);\n  }\n};\n\nHTMLActuator.prototype.addTile = function (tile) {\n  var self = this;\n\n  var wrapper   = document.createElement(\"div\");\n  var inner     = document.createElement(\"div\");\n  var position  = tile.previousPosition || { x: tile.x, y: tile.y };\n  var positionClass = this.positionClass(position);\n\n  // We can't use classlist because it somehow glitches when replacing classes\n  var classes = [\"tile\", \"tile-\" + tile.value, positionClass];\n\n  if (tile.value > this.config.endScore) classes.push(\"tile-super\");\n\n  this.applyClasses(wrapper, classes);\n\n  inner.classList.add(\"tile-inner\");\n  inner.textContent = tile.value;\n\n  if (tile.previousPosition) {\n    // Make sure that the tile gets rendered in the previous position first\n    window.requestAnimationFrame(function () {\n      classes[2] = self.positionClass({ x: tile.x, y: tile.y });\n      self.applyClasses(wrapper, classes); // Update the position\n    });\n  } else if (tile.mergedFrom) {\n    classes.push(\"tile-merged\");\n    this.applyClasses(wrapper, classes);\n\n    // Render the tiles that merged\n    tile.mergedFrom.forEach(function (merged) {\n      self.addTile(merged);\n    });\n  } else {\n    classes.push(\"tile-new\");\n    this.applyClasses(wrapper, classes);\n  }\n\n  // Add the inner part of the tile to the wrapper\n  wrapper.appendChild(inner);\n\n  // Put the tile on the board\n  this.tileContainer.appendChild(wrapper);\n};\n\nHTMLActuator.prototype.applyClasses = function (element, classes) {\n  element.setAttribute(\"class\", classes.join(\" \"));\n};\n\nHTMLActuator.prototype.normalizePosition = function (position) {\n  return { x: position.x + 1, y: position.y + 1 };\n};\n\nHTMLActuator.prototype.positionClass = function (position) {\n  position = this.normalizePosition(position);\n  return \"tile-position-\" + position.x + \"-\" + position.y;\n};\n\nHTMLActuator.prototype.updateScore = function (score) {\n  this.clearContainer(this.scoreContainer);\n\n  var difference = score - this.score;\n  this.score = score;\n\n  this.scoreContainer.textContent = this.score;\n\n  if (difference > 0) {\n    var addition = document.createElement(\"div\");\n    addition.classList.add(SCORE_ADD_CLASSNAME);\n    addition.textContent = \"+\" + difference;\n\n    this.scoreContainer.appendChild(addition);\n  }\n};\n\nHTMLActuator.prototype.updateBestScore = function (bestScore) {\n  this.bestContainer.textContent = bestScore;\n};\n\nHTMLActuator.prototype.message = function (won) {\n  var type    = won ? GAME_WIN_CLASSNAME : GAME_OVER_CLASSNAME;\n  var message = won ? this.config.playerWinMessage : this.config.playerLoseMessage;\n\n  this.messageContainer.classList.add(type);\n  this.messageContainer.getElementsByTagName(\"p\")[0].textContent = message;\n};\n\nHTMLActuator.prototype.clearMessage = function () {\n  // IE only takes one value to remove at a time.\n  this.messageContainer.classList.remove(GAME_WIN_CLASSNAME);\n  this.messageContainer.classList.remove(GAME_OVER_CLASSNAME);\n};\n\nexport default HTMLActuator;\n","window.fakeStorage = {\n  _data: {},\n\n  setItem: function (id, val) {\n    return this._data[id] = String(val);\n  },\n\n  getItem: function (id) {\n    return this._data.hasOwnProperty(id) ? this._data[id] : undefined;\n  },\n\n  removeItem: function (id) {\n    return delete this._data[id];\n  },\n\n  clear: function () {\n    return this._data = {};\n  }\n};\n\nfunction LocalStorageManager() {\n  this.bestScoreKey     = \"bestScore\";\n  this.gameStateKey     = \"gameState\";\n\n  var supported = this.localStorageSupported();\n  this.storage = supported ? window.localStorage : window.fakeStorage;\n}\n\nLocalStorageManager.prototype.localStorageSupported = function () {\n  var testKey = \"test\";\n\n  try {\n    var storage = window.localStorage;\n    storage.setItem(testKey, \"1\");\n    storage.removeItem(testKey);\n    return true;\n  } catch (error) {\n    return false;\n  }\n};\n\n// Best score getters/setters\nLocalStorageManager.prototype.getBestScore = function () {\n  return this.storage.getItem(this.bestScoreKey) || 0;\n};\n\nLocalStorageManager.prototype.setBestScore = function (score) {\n  this.storage.setItem(this.bestScoreKey, score);\n};\n\n// Game state getters/setters and clearing\nLocalStorageManager.prototype.getGameState = function () {\n  var stateJSON = this.storage.getItem(this.gameStateKey);\n  return stateJSON ? JSON.parse(stateJSON) : null;\n};\n\nLocalStorageManager.prototype.setGameState = function (gameState) {\n  this.storage.setItem(this.gameStateKey, JSON.stringify(gameState));\n};\n\nLocalStorageManager.prototype.clearGameState = function () {\n  this.storage.removeItem(this.gameStateKey);\n};\n\nexport default LocalStorageManager;\n","import Grid from './grid';\nimport Tile from './tile';\nimport KeyboardInputManager from '../js/keyboard_input_manager'\nimport HTMLActuator from '../js/html_actuator'\nimport LocalStorageManager from '../js/local_storage_manager'\n\n/**\n * Core Game Manager\n * @param {GameConfig} config\n * @constructor\n */\nfunction GameManager(config) {\n  this.config         = config;\n  this.size           = config.size;\n  this.inputManager   = new KeyboardInputManager(config);\n  this.storageManager = new LocalStorageManager(config);\n  this.actuator       = new HTMLActuator(config);\n\n  this.startTiles     = config.startTiles;\n\n  this.inputManager.on(\"move\", this.move.bind(this));\n  this.inputManager.on(\"restart\", this.restart.bind(this));\n  this.inputManager.on(\"keepPlaying\", this.keepPlaying.bind(this));\n\n  this.setup();\n}\n\n// Restart the game\nGameManager.prototype.restart = function () {\n  this.storageManager.clearGameState();\n  this.actuator.continueGame(); // Clear the game won/lost message\n  this.setup();\n};\n\n// Keep playing after winning (allows going over 2048)\nGameManager.prototype.keepPlaying = function () {\n  this.keepPlaying = true;\n  this.actuator.continueGame(); // Clear the game won/lost message\n};\n\n// Return true if the game is lost, or has won and the user hasn't kept playing\nGameManager.prototype.isGameTerminated = function () {\n  return this.over || (this.won && !this.keepPlaying);\n};\n\n// Set up the game\nGameManager.prototype.setup = function () {\n  var previousState = this.storageManager.getGameState();\n\n  // Reload the game from a previous game if present\n  if (previousState) {\n    this.grid        = new Grid(previousState.grid.size,\n                                previousState.grid.cells); // Reload grid\n    this.score       = previousState.score;\n    this.over        = previousState.over;\n    this.won         = previousState.won;\n    this.keepPlaying = previousState.keepPlaying;\n  } else {\n    this.grid        = new Grid(this.size);\n    this.score       = 0;\n    this.over        = false;\n    this.won         = false;\n    this.keepPlaying = false;\n\n    // Add the initial tiles\n    this.addStartTiles();\n  }\n\n  // Update the actuator\n  this.actuate();\n};\n\n// Set up the initial tiles to start the game with\nGameManager.prototype.addStartTiles = function () {\n  for (var i = 0; i < this.startTiles; i++) {\n    this.addRandomTile();\n  }\n};\n\n// Adds a tile in a random position\nGameManager.prototype.addRandomTile = function () {\n  if (this.grid.cellsAvailable()) {\n    var value = Math.random() < 0.9 ? this.config.initValue : this.config.nextValue(this.config.initValue);\n    var tile = new Tile(this.grid.randomAvailableCell(), value);\n\n    this.grid.insertTile(tile);\n  }\n};\n\n// Sends the updated grid to the actuator\nGameManager.prototype.actuate = function () {\n  if (this.storageManager.getBestScore() < this.score) {\n    this.storageManager.setBestScore(this.score);\n  }\n\n  // Clear the state when the game is over (game over only, not win)\n  if (this.over) {\n    this.storageManager.clearGameState();\n  } else {\n    this.storageManager.setGameState(this.serialize());\n  }\n\n  this.actuator.actuate(this.grid, {\n    score:      this.score,\n    over:       this.over,\n    won:        this.won,\n    bestScore:  this.storageManager.getBestScore(),\n    terminated: this.isGameTerminated()\n  });\n\n};\n\n// Represent the current game as an object\nGameManager.prototype.serialize = function () {\n  return {\n    grid:        this.grid.serialize(),\n    score:       this.score,\n    over:        this.over,\n    won:         this.won,\n    keepPlaying: this.keepPlaying\n  };\n};\n\n// Save all tile positions and remove merger info\nGameManager.prototype.prepareTiles = function () {\n  this.grid.eachCell(function (x, y, tile) {\n    if (tile) {\n      tile.mergedFrom = null;\n      tile.savePosition();\n    }\n  });\n};\n\n// Move a tile and its representation\nGameManager.prototype.moveTile = function (tile, cell) {\n  this.grid.cells[tile.x][tile.y] = null;\n  this.grid.cells[cell.x][cell.y] = tile;\n  tile.updatePosition(cell);\n};\n\n// Move tiles on the grid in the specified direction\nGameManager.prototype.move = function (direction) {\n  // 0: up, 1: right, 2: down, 3: left\n  var self = this;\n  var endScore = this.config.endScore;\n\n  if (this.isGameTerminated()) return; // Don't do anything if the game's over\n\n  var cell, tile;\n\n  var vector     = this.getVector(direction);\n  var traversals = this.buildTraversals(vector);\n  var moved      = false;\n\n  // Save the current tile positions and remove merger information\n  this.prepareTiles();\n\n  // Traverse the grid in the right direction and move tiles\n  traversals.x.forEach(function (x) {\n    traversals.y.forEach(function (y) {\n      cell = { x: x, y: y };\n      tile = self.grid.cellContent(cell);\n\n      if (tile) {\n        var positions = self.findFarthestPosition(cell, vector);\n        var next      = self.grid.cellContent(positions.next);\n\n        // Only one merger per row traversal?\n        if (next && next.value === tile.value && !next.mergedFrom) {\n          var merged = new Tile(positions.next, self.config.nextValue(tile.value));\n          merged.mergedFrom = [tile, next];\n\n          self.grid.insertTile(merged);\n          self.grid.removeTile(tile);\n\n          // Converge the two tiles' positions\n          tile.updatePosition(positions.next);\n\n          // Update the score\n          self.score += merged.value;\n\n          // The mighty 2048 tile\n          if (merged.value === endScore) self.won = true;\n        } else {\n          self.moveTile(tile, positions.farthest);\n        }\n\n        if (!self.positionsEqual(cell, tile)) {\n          moved = true; // The tile moved from its original cell!\n        }\n      }\n    });\n  });\n\n  if (moved) {\n    this.addRandomTile();\n\n    if (!this.movesAvailable()) {\n      this.over = true; // Game over!\n    }\n\n    this.actuate();\n  }\n};\n\n// Get the vector representing the chosen direction\nGameManager.prototype.getVector = function (direction) {\n  // Vectors representing tile movement\n  var map = {\n    0: { x: 0,  y: -1 }, // Up\n    1: { x: 1,  y: 0 },  // Right\n    2: { x: 0,  y: 1 },  // Down\n    3: { x: -1, y: 0 }   // Left\n  };\n\n  return map[direction];\n};\n\n// Build a list of positions to traverse in the right order\nGameManager.prototype.buildTraversals = function (vector) {\n  var traversals = { x: [], y: [] };\n\n  for (var pos = 0; pos < this.size; pos++) {\n    traversals.x.push(pos);\n    traversals.y.push(pos);\n  }\n\n  // Always traverse from the farthest cell in the chosen direction\n  if (vector.x === 1) traversals.x = traversals.x.reverse();\n  if (vector.y === 1) traversals.y = traversals.y.reverse();\n\n  return traversals;\n};\n\nGameManager.prototype.findFarthestPosition = function (cell, vector) {\n  var previous;\n\n  // Progress towards the vector direction until an obstacle is found\n  do {\n    previous = cell;\n    cell     = { x: previous.x + vector.x, y: previous.y + vector.y };\n  } while (this.grid.withinBounds(cell) &&\n           this.grid.cellAvailable(cell));\n\n  return {\n    farthest: previous,\n    next: cell // Used to check if a merge is required\n  };\n};\n\nGameManager.prototype.movesAvailable = function () {\n  return this.grid.cellsAvailable() || this.tileMatchesAvailable();\n};\n\n// Check for available matches between tiles (more expensive check)\nGameManager.prototype.tileMatchesAvailable = function () {\n  var self = this;\n\n  var tile;\n\n  for (var x = 0; x < this.size; x++) {\n    for (var y = 0; y < this.size; y++) {\n      tile = this.grid.cellContent({ x: x, y: y });\n\n      if (tile) {\n        for (var direction = 0; direction < 4; direction++) {\n          var vector = self.getVector(direction);\n          var cell   = { x: x + vector.x, y: y + vector.y };\n\n          var other  = self.grid.cellContent(cell);\n\n          if (other && other.value === tile.value) {\n            return true; // These two tiles can be merged\n          }\n        }\n      }\n    }\n  }\n\n  return false;\n};\n\nGameManager.prototype.positionsEqual = function (first, second) {\n  return first.x === second.x && first.y === second.y;\n};\n\nexport default GameManager;\n","/**\n * 2018/1/26\n *\n * Copyright(c) Alibaba Group Holding Limited.\n *\n * Authors:\n *   乔杨 <peiqiao.ppq@alipay.com>\n */\n\n'use strict'\n\n/**\n * create Element\n * @param {string} tagName\n * @param {?Object} attr\n * @param {?Array<Element>} children\n * @return {Element}\n */\nexport function createElement (tagName, attr, children) {\n  const node = document.createElement(tagName)\n  Object.assign(node, attr);\n  (children || []).forEach(child => {\n    node.appendChild(child)\n  })\n  return node\n}\n","/**\n * 2018/1/25\n *\n * Copyright(c) Alibaba Group Holding Limited.\n *\n * Authors:\n *   乔杨 <peiqiao.ppq@alipay.com>\n */\n\n'use strict'\n\nimport '../js/animframe_polyfill'\n\nimport GameManager from '../js/game_manager'\nimport { createElement } from './tool'\n\n/**\n * default game config\n * @type {GameConfig}\n */\nconst DEFAULT_GAME_CONFIG = {\n  size: 4,\n  startTiles: 2,\n  initValue: 2,\n  endScore: 2048,\n  playerWinMessage: 'You Win!',\n  playerLoseMessage: 'Game Over!',\n  newGameButtonText: 'New Game',\n  title: '2048',\n  desc: 'Join the numbers and get to the 2048 tile!',\n  nextValue: v => v * 2\n}\n\nclass Game {\n  /**\n   * @typedef {Object} GameConfig\n   * @property {number} size - size of the grid\n   * @property {Element} gameContainer - the main container of the game\n   * @property {?number} startTiles - numbers of tiles in the beginning\n   * @property {?number} initValue - value of the first tile\n   * @property {?number} endScore - number of the score to end the game\n   * @property {?string} title\n   * @property {?string} desc\n   * @property {?string} playerWinMessage\n   * @property {?string} playerLoseMessage\n   * @property {?Element} gameMessageContainer\n   * @property {?Element} tileContainer\n   * @property {?Element} retryButton\n   * @property {?Element} keepPlayingButton\n   * @property {?Element} scoreContainer\n   * @property {?Element} bestContainer\n   * @property {?function} nextValue - return next value by previous\n   */\n\n  /**\n   * Game Manager Class\n   * @param {GameConfig} config\n   */\n  constructor (config) {\n    this.config = Object.assign({}, DEFAULT_GAME_CONFIG, config)\n    this.initDOM()\n    this.gameManager = new GameManager(this.config)\n  }\n\n  /**\n   * init default DOM element\n   * @return {Object}\n   */\n  initDOM () {\n    const config = this.config\n    config.scoreContainer = config.scoreContainer || createElement('div', { className: 'score-container', innerText: '0' })\n    config.bestContainer = config.bestContainer || createElement('div', { className: 'best-container', innerText: '0' })\n    config.retryButton = config.retryButton || createElement('a', { className: 'retry-button', innerText: 'Try again' })\n    config.keepPlayingButton = config.keepPlayingButton || createElement('a', { className: 'keep-playing-button', innerText: 'Keep going' })\n    config.gameMessageContainer = config.gameMessageContainer || createElement('div', { className: 'game-message' }, [\n      createElement('p'),\n      createElement('div', { className: 'lower' }, [\n        config.keepPlayingButton,\n        config.retryButton\n      ])\n    ])\n    config.tileContainer = config.tileContainer || createElement('div', { className: 'tile-container' })\n    config.gridContainer = createElement('div', { className: 'grid-container' }, Array.apply(null, Array(config.size)).map(() => createElement('div', { className: 'grid-row' }, Array.apply(null, Array(config.size)).map(() => createElement('div', { className: 'grid-cell' })))))\n    if (!config.gameContainer || !(config.gameContainer instanceof window.HTMLElement)) {\n      throw new TypeError('gameContainer should be an HTMLElement! did you forget to pass an element to the Game constructor?')\n    }\n    config.gameContainer.appendChild(createElement('div', { className: 'heading' }, [\n      createElement('h1', { className: 'title', innerText: config.title }),\n      createElement('div', { className: 'scores-container' }, [\n        config.scoreContainer,\n        config.bestContainer\n      ])\n    ]))\n    config.gameContainer.appendChild(createElement('div', { className: 'above-game' }, [\n      createElement('div', { className: 'game-intro', innerText: config.desc }),\n      createElement('div', { className: 'restart-button', innerText: config.newGameButtonText })\n    ]))\n    config.gameContainer.appendChild(createElement('div', { className: 'game-container' }, [\n      config.gameMessageContainer,\n      config.gridContainer,\n      config.tileContainer\n    ]))\n  }\n}\n\nexport default Game\n"],"names":["lastTime","vendors","x","length","window","requestAnimationFrame","cancelAnimationFrame","callback","currTime","Date","getTime","timeToCall","Math","max","id","setTimeout","Tile","position","value","y","previousPosition","mergedFrom","prototype","savePosition","updatePosition","serialize","Grid","size","previousState","cells","fromState","empty","row","push","state","tile","randomAvailableCell","availableCells","floor","random","eachCell","cellsAvailable","cellAvailable","cell","cellOccupied","cellContent","withinBounds","insertTile","removeTile","cellState","KeyboardInputManager","config","events","navigator","msPointerEnabled","eventTouchstart","eventTouchmove","eventTouchend","listen","on","event","emit","data","callbacks","forEach","self","map","addEventListener","modifiers","altKey","ctrlKey","metaKey","shiftKey","mapped","which","targetIsInput","undefined","preventDefault","restart","call","bindButtonPress","retryButton","keepPlayingButton","keepPlaying","touchStartClientX","touchStartClientY","gameContainer","touches","targetTouches","pageX","pageY","clientX","clientY","touchEndClientX","touchEndClientY","changedTouches","dx","absDx","abs","dy","absDy","selector","fn","button","HTMLElement","document","querySelector","bind","target","tagName","toLowerCase","GAME_WIN_CLASSNAME","GAME_OVER_CLASSNAME","SCORE_ADD_CLASSNAME","HTMLActuator","tileContainer","scoreContainer","bestContainer","messageContainer","gameMessageContainer","score","actuate","grid","metadata","clearContainer","column","addTile","updateScore","updateBestScore","bestScore","terminated","over","message","won","continueGame","clearMessage","container","firstChild","removeChild","wrapper","createElement","inner","positionClass","classes","endScore","applyClasses","classList","add","textContent","merged","appendChild","element","setAttribute","join","normalizePosition","difference","addition","type","playerWinMessage","playerLoseMessage","getElementsByTagName","remove","fakeStorage","val","_data","String","hasOwnProperty","LocalStorageManager","bestScoreKey","gameStateKey","supported","localStorageSupported","storage","localStorage","testKey","setItem","removeItem","error","getBestScore","getItem","setBestScore","getGameState","stateJSON","JSON","parse","setGameState","gameState","stringify","clearGameState","GameManager","inputManager","storageManager","actuator","startTiles","move","setup","isGameTerminated","addStartTiles","i","addRandomTile","initValue","nextValue","prepareTiles","moveTile","direction","vector","getVector","traversals","buildTraversals","moved","positions","findFarthestPosition","next","farthest","positionsEqual","movesAvailable","pos","reverse","previous","tileMatchesAvailable","other","first","second","attr","children","node","assign","child","DEFAULT_GAME_CONFIG","v","Game","Object","initDOM","gameManager","className","innerText","gridContainer","Array","apply","TypeError","title","desc","newGameButtonText"],"mappings":"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"}